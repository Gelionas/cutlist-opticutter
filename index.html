<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cabinet Cutlist Tool</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  input, button, textarea { margin: 5px 0; padding: 5px; width: 100%; }
  button { background: #2c7; border: none; color: white; font-weight: bold; cursor: pointer; }
  button:hover { background: #1a5; }
</style>
</head>
<body>
<h2>Cabinet Cutlist Tool</h2>

<label>Face Frame Reveal (default 1/4")</label>
<input id="frameReveal" value="1/4">

<label>Panel Thickness (default 1/2")</label>
<input id="panelThickness" value="1/2">

<label>Frame Thickness (default 3/4")</label>
<input id="frameThickness" value="3/4">

<label>Dado Depth (default 1/8")</label>
<input id="dadoDepth" value="1/8">

<label>Height Margin (default 0")</label>
<input id="heightMargin" value="0">

<label>Default Cabinet Height</label>
<input id="defaultHeight" value="34 1/2">

<label>Default Cabinet Depth</label>
<input id="defaultDepth" value="24">

<label>Kerf (default 3/32")</label>
<input id="kerf" value="3/32">

<label>Face Frame Widths & Qty (one per line: width, qty)</label>
<textarea id="batchInput" rows="5">18,1
24,2</textarea>

<button onclick="generateBatchCutList()">Generate CSV</button>
<button onclick="openOptiCutter()">Open OptiCutter Import</button>

<script>
function parseFraction(str) {
    str = str.trim();
    if (str.includes(' ')) { // mixed number
        let [whole, frac] = str.split(' ');
        let [num, den] = frac.split('/');
        return parseInt(whole) + (parseInt(num) / parseInt(den));
    } else if (str.includes('/')) { // fraction only
        let [num, den] = str.split('/');
        return parseInt(num) / parseInt(den);
    }
    return parseFloat(str);
}

function toFraction(value) {
    let whole = Math.floor(value);
    let frac = value - whole;
    let precision = 64; // up to 1/64"
    let num = Math.round(frac * precision);
    let den = precision;
    while (num && den % 2 === 0 && num % 2 === 0) {
        num /= 2; den /= 2;
    }
    if (whole === 0 && num > 0) return `${num}/${den}`;
    if (num === 0) return `${whole}`;
    return `${whole} ${num}/${den}`;
}

function generateBatchCutList() {
    const parts = [];
    const FR = parseFraction(document.getElementById('frameReveal').value);
    const PT = parseFraction(document.getElementById('panelThickness').value);
    const FT = parseFraction(document.getElementById('frameThickness').value);
    const DD = parseFraction(document.getElementById('dadoDepth').value);
    const HM = parseFraction(document.getElementById('heightMargin').value);
    const defaultHeight = parseFraction(document.getElementById('defaultHeight').value);
    const defaultDepth = parseFraction(document.getElementById('defaultDepth').value);

    document.getElementById('batchInput').value.split('\n').forEach(line => {
        if (!line.trim()) return;
        let [faceFrameWidth, qty] = line.split(',').map(x => x.trim());
        qty = qty ? parseInt(qty) : 1;
        const W = parseFraction(faceFrameWidth);

        const boxWidth = W - (2 * FR);
        const sideDepth = defaultDepth - FT + DD;
        const betweenSidesWidth = boxWidth - (2 * PT);
        const bottomDepth = sideDepth - PT;
        const sideHeight = defaultHeight;
        const backHeight = defaultHeight - HM;

        parts.push({ partName: `Side`, width: sideDepth, height: sideHeight, qty: qty * 2 });
        parts.push({ partName: `Bottom ${faceFrameWidth}`, width: betweenSidesWidth, height: bottomDepth, qty: qty });
        parts.push({ partName: `Back ${faceFrameWidth}`, width: betweenSidesWidth, height: backHeight, qty: qty });
    });

    downloadCSV(parts);
}

function downloadCSV(parts) {
    let csv = "Part;Width;Height;Quantity;Material;Notes\n";
    parts.forEach(p => {
        csv += `${p.partName};${toFraction(p.width)};${toFraction(p.height)};${p.qty};;\n`;
    });
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = "cutlist.csv";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}

function openOptiCutter() {
    window.open("https://www.opticutter.com/app/import", "_blank");
}
</script>
</body>
</html>
